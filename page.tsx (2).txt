"use client"

import { useState } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Button } from "@/components/ui/button"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import {
  ArrowUpRight,
  ArrowDownRight,
  DollarSign,
  Users,
  CreditCard,
  TrendingUp,
  Globe,
  MapPin,
  Calendar,
  Clock,
  Download,
  FileText,
  BarChart2,
  Filter,
} from "lucide-react"
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@/components/ui/breadcrumb"
import { LineChart, BarChart, PieChart as PieChartComponent } from "@/components/charts"
import { getAnalyticsData } from "@/lib/data"

export default function AnalyticsPage() {
  const [timeRange, setTimeRange] = useState("month")
  const [data, setData] = useState(getAnalyticsData(timeRange))
  const [loading, setLoading] = useState(false)

  // Handle time range change
  const handleTimeRangeChange = (value) => {
    setLoading(true)
    setTimeRange(value)

    // Simulate API delay
    setTimeout(() => {
      setData(getAnalyticsData(value))
      setLoading(false)
    }, 800)
  }

  // Seasonal trends
  const seasonalData = [
    { month: "Jan", bookings: 320 },
    { month: "Feb", bookings: 350 },
    { month: "Mar", bookings: 420 },
    { month: "Apr", bookings: 460 },
    { month: "May", bookings: 520 },
    { month: "Jun", bookings: 580 },
    { month: "Jul", bookings: 620 },
    { month: "Aug", bookings: 650 },
    { month: "Sep", bookings: 580 },
    { month: "Oct", bookings: 510 },
    { month: "Nov", bookings: 450 },
    { month: "Dec", bookings: 400 },
  ]

  // Demographics data
  const ageDistribution = [
    { age: "18-24", percentage: 15 },
    { age: "25-34", percentage: 30 },
    { age: "35-44", percentage: 25 },
    { age: "45-54", percentage: 18 },
    { age: "55-64", percentage: 8 },
    { age: "65+", percentage: 4 },
  ]

  const genderDistribution = [
    { gender: "Male", value: 48 },
    { gender: "Female", value: 50 },
    { gender: "Other", value: 2 },
  ]

  // Forecast data
  const forecastData = {
    revenueForecast: [
      { month: "Jul", revenue: 175000 },
      { month: "Aug", revenue: 182000 },
      { month: "Sep", revenue: 168000 },
      { month: "Oct", revenue: 155000 },
      { month: "Nov", revenue: 148000 },
      { month: "Dec", revenue: 172000 },
    ],
    bookingsForecast: [
      { month: "Jul", bookings: 650 },
      { month: "Aug", bookings: 680 },
      { month: "Sep", bookings: 620 },
      { month: "Oct", bookings: 580 },
      { month: "Nov", bookings: 540 },
      { month: "Dec", bookings: 630 },
    ],
  }

  return (
    <div className="container py-10">
      <Breadcrumb className="mb-6">
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink href="/">Home</BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            <BreadcrumbLink href="/admin">Admin</BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            <BreadcrumbPage>Analytics</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>

      <div className="flex flex-col gap-8">
        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h1 className="text-3xl font-bold tracking-tight">Advanced Analytics</h1>
            <p className="text-muted-foreground mt-1">Comprehensive insights into your airline operations</p>
          </div>
          <div className="flex items-center gap-4">
            <Button
              variant="outline"
              className="border-primary text-primary hover:bg-primary hover:text-white"
              onClick={() => {
                // Simulate refresh
                setLoading(true)
                setTimeout(() => setLoading(false), 800)
              }}
            >
              Refresh Data
            </Button>
            <Select value={timeRange} onValueChange={handleTimeRangeChange}>
              <SelectTrigger className="w-[180px] border-gray-200">
                <SelectValue placeholder="Select time range" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="week">Last 7 days</SelectItem>
                <SelectItem value="month">Last 30 days</SelectItem>
                <SelectItem value="quarter">Last 90 days</SelectItem>
                <SelectItem value="year">Last 12 months</SelectItem>
              </SelectContent>
            </Select>
          </div>
        </div>

        {loading ? (
          <div className="flex justify-center items-center h-[60vh]">
            <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
          </div>
        ) : (
          <>
            <div className="grid gap-6 md:grid-cols-4">
              <Card className="border-2 border-gray-200 shadow-md hover:shadow-lg transition-all">
                <CardHeader className="pb-2">
                  <CardDescription className="flex items-center">
                    <DollarSign className="h-4 w-4 mr-1 text-primary" />
                    Total Revenue
                  </CardDescription>
                  <CardTitle className="text-3xl text-primary">${data.totalRevenue.toLocaleString()}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div
                    className={`flex items-center text-sm ${data.revenueChange >= 0 ? "text-green-500" : "text-red-500"}`}
                  >
                    {data.revenueChange >= 0 ? (
                      <ArrowUpRight className="h-4 w-4 mr-1" />
                    ) : (
                      <ArrowDownRight className="h-4 w-4 mr-1" />
                    )}
                    <span>
                      {data.revenueChange >= 0 ? "+" : ""}
                      {data.revenueChange}% from previous period
                    </span>
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2 border-gray-200 shadow-md hover:shadow-lg transition-all">
                <CardHeader className="pb-2">
                  <CardDescription className="flex items-center">
                    <Users className="h-4 w-4 mr-1 text-primary" />
                    Total Bookings
                  </CardDescription>
                  <CardTitle className="text-3xl text-primary">{data.totalBookings.toLocaleString()}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div
                    className={`flex items-center text-sm ${data.bookingsChange >= 0 ? "text-green-500" : "text-red-500"}`}
                  >
                    {data.bookingsChange >= 0 ? (
                      <ArrowUpRight className="h-4 w-4 mr-1" />
                    ) : (
                      <ArrowDownRight className="h-4 w-4 mr-1" />
                    )}
                    <span>
                      {data.bookingsChange >= 0 ? "+" : ""}
                      {data.bookingsChange}% from previous period
                    </span>
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2 border-gray-200 shadow-md hover:shadow-lg transition-all">
                <CardHeader className="pb-2">
                  <CardDescription className="flex items-center">
                    <CreditCard className="h-4 w-4 mr-1 text-primary" />
                    Average Ticket Price
                  </CardDescription>
                  <CardTitle className="text-3xl text-primary">${data.avgTicketPrice}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div
                    className={`flex items-center text-sm ${data.avgPriceChange >= 0 ? "text-green-500" : "text-red-500"}`}
                  >
                    {data.avgPriceChange >= 0 ? (
                      <ArrowUpRight className="h-4 w-4 mr-1" />
                    ) : (
                      <ArrowDownRight className="h-4 w-4 mr-1" />
                    )}
                    <span>
                      {data.avgPriceChange >= 0 ? "+" : ""}
                      {data.avgPriceChange}% from previous period
                    </span>
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2 border-gray-200 shadow-md hover:shadow-lg transition-all">
                <CardHeader className="pb-2">
                  <CardDescription className="flex items-center">
                    <TrendingUp className="h-4 w-4 mr-1 text-primary" />
                    Profit Margin
                  </CardDescription>
                  <CardTitle className="text-3xl text-primary">28.5%</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="flex items-center text-sm text-green-500">
                    <ArrowUpRight className="h-4 w-4 mr-1" />
                    <span>+2.3% from previous period</span>
                  </div>
                </CardContent>
              </Card>
            </div>

            <Tabs defaultValue="revenue" className="space-y-4">
              <TabsList className="bg-gray-100 p-1">
                <TabsTrigger value="revenue" className="data-[state=active]:bg-primary data-[state=active]:text-white">
                  Revenue
                </TabsTrigger>
                <TabsTrigger value="bookings" className="data-[state=active]:bg-primary data-[state=active]:text-white">
                  Bookings
                </TabsTrigger>
                <TabsTrigger value="routes" className="data-[state=active]:bg-primary data-[state=active]:text-white">
                  Popular Routes
                </TabsTrigger>
                <TabsTrigger value="forecast" className="data-[state=active]:bg-primary data-[state=active]:text-white">
                  Forecasting
                </TabsTrigger>
                <TabsTrigger
                  value="demographics"
                  className="data-[state=active]:bg-primary data-[state=active]:text-white"
                >
                  Demographics
                </TabsTrigger>
              </TabsList>

              <TabsContent value="revenue">
                <div className="grid gap-6 md:grid-cols-2">
                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Revenue Over Time</CardTitle>
                      <CardDescription>Track your revenue trends over the selected time period</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <LineChart
                          data={data.revenueData}
                          xAxis="date"
                          yAxis="amount"
                          categories={["Revenue", "Costs"]}
                        />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Profit Margin Analysis</CardTitle>
                      <CardDescription>Breakdown of profit margins by quarter</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <BarChart data={data.profitMargin} xAxis="category" yAxis="percentage" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md md:col-span-2">
                    <CardHeader>
                      <div className="flex flex-col md:flex-row justify-between md:items-center">
                        <div>
                          <CardTitle className="text-primary">Revenue Breakdown by Route</CardTitle>
                          <CardDescription>Revenue distribution across different flight routes</CardDescription>
                        </div>
                        <div className="flex items-center gap-2 mt-2 md:mt-0">
                          <Button variant="outline" size="sm">
                            <Filter className="h-4 w-4 mr-2" />
                            Filter
                          </Button>
                          <Button variant="outline" size="sm">
                            <Download className="h-4 w-4 mr-2" />
                            Export
                          </Button>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <BarChart
                          data={data.popularRoutes.map((item) => ({
                            route: item.route,
                            revenue: item.bookings * data.avgTicketPrice,
                          }))}
                          xAxis="route"
                          yAxis="revenue"
                        />
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>

              <TabsContent value="bookings">
                <div className="grid gap-6 md:grid-cols-2">
                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Bookings by Class</CardTitle>
                      <CardDescription>Distribution of bookings across different seat classes</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full flex justify-center">
                        <div className="h-full w-2/3">
                          <PieChartComponent data={data.bookingsByClass} category="class" value="count" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Seasonal Booking Trends</CardTitle>
                      <CardDescription>Booking patterns throughout the year</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <LineChart data={seasonalData} xAxis="month" yAxis="bookings" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md md:col-span-2">
                    <CardHeader>
                      <CardTitle className="text-primary">Booking Conversion Rate</CardTitle>
                      <CardDescription>Percentage of website visitors who complete a booking</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="flex flex-col items-center justify-center">
                          <div className="text-5xl font-bold text-primary mb-2">4.8%</div>
                          <div className="text-sm text-gray-600">Overall Conversion Rate</div>
                          <div className="flex items-center text-sm text-green-500 mt-2">
                            <ArrowUpRight className="h-4 w-4 mr-1" />
                            <span>+0.3% from previous period</span>
                          </div>
                        </div>

                        <div className="col-span-2">
                          <div className="h-[300px] w-full">
                            <LineChart
                              data={[
                                { month: "Jan", rate: 4.2 },
                                { month: "Feb", rate: 4.3 },
                                { month: "Mar", rate: 4.5 },
                                { month: "Apr", rate: 4.6 },
                                { month: "May", rate: 4.7 },
                                { month: "Jun", rate: 4.8 },
                              ]}
                              xAxis="month"
                              yAxis="rate"
                            />
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>

              <TabsContent value="routes">
                <div className="grid gap-6 md:grid-cols-2">
                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Top 10 Popular Routes</CardTitle>
                      <CardDescription>Most booked flight routes during the selected period</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <BarChart data={data.popularRoutes} xAxis="route" yAxis="bookings" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Route Occupancy Rates</CardTitle>
                      <CardDescription>Average seat occupancy by route</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <BarChart
                          data={data.popularRoutes.slice(0, 6).map((route, i) => ({
                            route: route.route,
                            occupancy: [85, 92, 78, 88, 76, 82][i],
                          }))}
                          xAxis="route"
                          yAxis="occupancy"
                        />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md md:col-span-2">
                    <CardHeader>
                      <CardTitle className="text-primary">Global Route Map</CardTitle>
                      <CardDescription>Visual representation of flight routes and frequencies</CardDescription>
                    </CardHeader>
                    <CardContent className="h-[400px] flex items-center justify-center">
                      <div className="text-center">
                        <Globe className="h-16 w-16 text-primary opacity-20 mx-auto mb-4" />
                        <p className="text-gray-600">Interactive route map visualization</p>
                        <p className="text-sm text-gray-500 mt-2">
                          Showing connections between 42 cities across 18 countries
                        </p>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>

              <TabsContent value="forecast">
                <div className="grid gap-6 md:grid-cols-2">
                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Revenue Forecast</CardTitle>
                      <CardDescription>Projected revenue for the next 6 months</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <LineChart data={forecastData.revenueForecast} xAxis="month" yAxis="revenue" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Bookings Forecast</CardTitle>
                      <CardDescription>Projected bookings for the next 6 months</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <LineChart data={forecastData.bookingsForecast} xAxis="month" yAxis="bookings" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md md:col-span-2">
                    <CardHeader>
                      <CardTitle className="text-primary">Predictive Analytics</CardTitle>
                      <CardDescription>AI-powered predictions and insights</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                          <div className="flex items-center gap-2 mb-2">
                            <TrendingUp className="h-5 w-5 text-green-500" />
                            <h3 className="font-medium text-primary">Growth Opportunity</h3>
                          </div>
                          <p className="text-sm text-gray-600">
                            NYC-TOK route shows 28% potential growth based on search patterns and competitor pricing.
                          </p>
                        </div>

                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                          <div className="flex items-center gap-2 mb-2">
                            <Clock className="h-5 w-5 text-amber-500" />
                            <h3 className="font-medium text-primary">Optimal Pricing Time</h3>
                          </div>
                          <p className="text-sm text-gray-600">
                            Bookings increase 15% when prices are adjusted on Tuesdays, 6-8 weeks before departure.
                          </p>
                        </div>

                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                          <div className="flex items-center gap-2 mb-2">
                            <Calendar className="h-5 w-5 text-primary" />
                            <h3 className="font-medium text-primary">Seasonal Insight</h3>
                          </div>
                          <p className="text-sm text-gray-600">
                            Predicted 22% increase in business class bookings for Q3 based on historical patterns.
                          </p>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>

              <TabsContent value="demographics">
                <div className="grid gap-6 md:grid-cols-2">
                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Age Distribution</CardTitle>
                      <CardDescription>Passenger demographics by age group</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full">
                        <BarChart data={ageDistribution} xAxis="age" yAxis="percentage" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md">
                    <CardHeader>
                      <CardTitle className="text-primary">Gender Distribution</CardTitle>
                      <CardDescription>Passenger demographics by gender</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="h-[400px] w-full flex justify-center">
                        <div className="h-full w-2/3">
                          <PieChartComponent data={genderDistribution} category="gender" value="value" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="border-2 border-gray-200 shadow-md md:col-span-2">
                    <CardHeader>
                      <CardTitle className="text-primary">Passenger Origin Countries</CardTitle>
                      <CardDescription>Top countries of origin for passengers</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="space-y-4">
                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>United States</span>
                            </div>
                            <span className="font-medium">32%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "32%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>United Kingdom</span>
                            </div>
                            <span className="font-medium">18%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "18%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>Japan</span>
                            </div>
                            <span className="font-medium">12%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "12%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>Germany</span>
                            </div>
                            <span className="font-medium">8%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "8%" }}></div>
                          </div>
                        </div>

                        <div className="space-y-4">
                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>France</span>
                            </div>
                            <span className="font-medium">7%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "7%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>Australia</span>
                            </div>
                            <span className="font-medium">6%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "6%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>Canada</span>
                            </div>
                            <span className="font-medium">5%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "5%" }}></div>
                          </div>

                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                              <MapPin className="h-4 w-4 text-primary" />
                              <span>Other Countries</span>
                            </div>
                            <span className="font-medium">12%</span>
                          </div>
                          <div className="w-full bg-gray-100 rounded-full h-2">
                            <div className="bg-primary h-2 rounded-full" style={{ width: "12%" }}></div>
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>
            </Tabs>

            <div className="flex justify-end gap-2">
              <Button variant="outline" className="border-primary text-primary hover:bg-primary hover:text-white">
                <FileText className="h-4 w-4 mr-2" />
                Generate PDF Report
              </Button>
              <Button className="bg-primary hover:bg-secondary">
                <BarChart2 className="h-4 w-4 mr-2" />
                Schedule Reports
              </Button>
            </div>
          </>
        )}
      </div>
    </div>
  )
}

